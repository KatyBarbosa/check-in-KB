<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Check-in Casamento Jackeline & Samarthony</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><path fill=%22%238BD24D%22 d=%22M8 14s6-4.35 6-8.5S10.75 1 8 4.5 2 5.5 2 5.5 2 9.65 8 14z%22/></svg>">
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family:sans-serif; margin:0; background:#fff; color:#333; }
.header { background-color:#8BD24D; color:white; padding:1.5rem; text-align:center; }
.header img { max-height:80px; margin-bottom:0.5rem; }
.fade-in { animation: fadeIn 0.5s ease-in; }
@keyframes fadeIn { from {opacity:0;transform:translateY(20px);} to {opacity:1;transform:translateY(0);} }
.pulse-success { animation: pulseSuccess 1.5s ease-in-out; }
@keyframes pulseSuccess {0%{transform:scale(1);}50%{transform:scale(1.05);background-color:#8BD24D;}100%{transform:scale(1);}}
.highlight { font-weight:bold; font-size:1.25rem; color:#8BD24D;}
.footer { text-align:center; padding:1rem; font-size:0.9rem; background:#f0f0f0; margin-top:2rem; }
.button-green { background-color:#8BD24D; color:white; padding:0.75rem 1rem; border-radius:0.75rem; font-weight:bold; cursor:pointer; transition:0.3s; }
.button-green:hover { background-color:#76b441; }
.button-gray { background-color:#ccc; color:#333; padding:0.5rem 1rem; border-radius:0.75rem; cursor:pointer; }
.hidden { display:none; }
input { padding:0.75rem; border-radius:0.75rem; border:2px solid #ccc; width:100%; margin-bottom:0.5rem; }
ul { list-style:none; padding:0; margin:0; }
li { cursor:pointer; }
</style>
</head>
<body>

<div class="header">
  <img src="monograma.png" alt="Monograma Jackeline & Samarthony" />
  <div class="text-lg font-bold">Jackeline & Samarthony</div>
  <div class="text-sm">06/12/2025 - Du Eventos</div>
</div>

<div class="max-w-xl mx-auto mt-6 bg-white p-6 rounded-xl shadow-md">
  <input type="text" id="searchInput" placeholder="Digite nome, apelido ou telefone" onkeyup="searchGuest(event)">
  <button class="button-green w-full mb-2" onclick="performSearch()">Buscar Convidado</button>
  <button class="button-gray w-full mb-2" onclick="refreshData()">üîÑ Atualizar Dados</button>

  <h3 class="font-bold mt-4 mb-2">‚è≥ Convidados Pendentes</h3>
  <ul id="pendingList" class="space-y-2"></ul>

  <h3 class="font-bold mt-4 mb-2">‚úÖ Convidados Confirmados</h3>
  <ul id="confirmedList" class="space-y-2"></ul>
</div>

<!-- Modal de Confirma√ß√£o -->
<div id="confirmationModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-xl max-w-sm text-center">
    <p id="modalMessage" class="mb-4 font-semibold"></p>
    <div class="flex justify-around">
      <button class="button-green" onclick="confirmCheckin()">Confirmar</button>
      <button class="button-gray" onclick="cancelCheckin()">Cancelar</button>
    </div>
  </div>
</div>

<!-- Tela de Check-in Confirmado -->
<div id="checkinConfirmation" class="hidden max-w-xl mx-auto mt-6 p-6 bg-white rounded-xl shadow-md fade-in text-center">
  <h2 class="text-2xl mb-2">‚úÖ Check-in realizado!</h2>
  <p id="confirmedName" class="mb-2 font-semibold"></p>
  <p id="confirmedTable" class="highlight mb-4"></p>
  <button class="button-gray" onclick="newSearch()">Novo Check-in</button>
</div>

<div class="footer">
  Criado por Katiene Barbosa
</div>

<script>
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxD6XpmlV52Jci_udnwqwdqUIXLHY7MvG5s2srloHYF8GCqgBeaJDSnrppF7jbcwaiM/exec';
let guests=[], selectedGuest=null;

async function loadGuestsFromSheets(){
  try{
    const res = await fetch(`${APPS_SCRIPT_URL}?action=getGuests`);
    const data = await res.json();
    if(data.success){
      guests = data.guests;
      updateGuestLists();
    }
  }catch(e){console.error(e);}
}

function updateGuestLists(){
  const confirmed = document.getElementById('confirmedList');
  const pending = document.getElementById('pendingList');
  confirmed.innerHTML = '';
  pending.innerHTML = '';
  guests.forEach(g=>{
    const item = document.createElement('li');
    item.className='p-3 rounded-xl border mb-1';
    item.innerHTML = `<strong>${g.nome}</strong> (${g.apelido}) - ${g.telefone} ‚Ä¢ <span class="highlight">${g.mesa}</span>`;
    if(g.status==='confirmado'){
      item.style.backgroundColor='#DFF5E0';
      confirmed.appendChild(item);
    } else {
      item.style.backgroundColor='#fff';
      item.onclick = ()=>openConfirmationModal(g);
      pending.appendChild(item);
    }
  });
}

function searchGuest(e){ if(e.key==='Enter') performSearch(); }

function performSearch(){
  const term = document.getElementById('searchInput').value.toLowerCase();
  if(!term){ updateGuestLists(); return; }
  guests.forEach(g=>{
    const allLists = document.querySelectorAll('#pendingList li, #confirmedList li');
    allLists.forEach(li=>li.style.display='none');
    if(g.nome.toLowerCase().includes(term) || g.apelido.toLowerCase().includes(term) || g.telefone.includes(term)){
      const list = g.status==='confirmado'? document.getElementById('confirmedList') : document.getElementById('pendingList');
      Array.from(list.children).forEach(li=>{
        if(li.textContent.includes(g.nome)) li.style.display='block';
      });
    }
  });
}

function openConfirmationModal(guest){
  selectedGuest = guest;
  document.getElementById('modalMessage').textContent = `Confirmar check-in de ${guest.nome} (${guest.mesa})?`;
  document.getElementById('confirmationModal').classList.remove('hidden');
}

function cancelCheckin(){ selectedGuest=null; document.getElementById('confirmationModal').classList.add('hidden'); }

async function confirmCheckin(){
  if(!selectedGuest) return;
  try{
    const payload = {action:'checkin', guestId:selectedGuest.id, timestamp:new Date().toISOString()};
    const res = await fetch(APPS_SCRIPT_URL,{method:'POST',body:JSON.stringify(payload)});
    const data = await res.json();
    if(data.success){
      selectedGuest.status='confirmado';
      updateGuestLists();
      showCheckinConfirmation(selectedGuest);
    }else{ alert(data.error); }
  }catch(e){console.error(e);}
  cancelCheckin();
}

function showCheckinConfirmation(guest){
  document.getElementById('confirmedName').textContent = guest.nome;
  document.getElementById('confirmedTable').textContent = guest.mesa;
  document.getElementById('checkinConfirmation').classList.remove('hidden');
  document.getElementById('checkinConfirmation').classList.add('pulse-success');
}

function newSearch(){
  selectedGuest=null;
  document.getElementById('searchInput').value='';
  document.getElementById('checkinConfirmation').classList.add('hidden'); 
  document.getElementById('checkinConfirmation').classList.remove('pulse-success');
  updateGuestLists();
  document.getElementById('searchInput').focus();
}

async function refreshData(){ await loadGuestsFromSheets(); alert('Dados atualizados!'); }

loadGuestsFromSheets();
document.getElementById('searchInput').focus();
</script>

</body>
</html>
