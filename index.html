<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Check-in Casamento Jackeline & Samarthony</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><path fill=%22%238BD24D%22 d=%22M8 14s6-4.35 6-8.5S10.75 1 8 4.5 2 5.5 2 5.5 2 9.65 8 14z%22/></svg>">
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family:sans-serif; margin:0; background:#fff; color:#333; }
.header { background-color:#8BD24D; color:white; padding:1.5rem; text-align:center; }
.header img { max-height:80px; margin-bottom:0.5rem; }
.fade-in { animation: fadeIn 0.5s ease-in; }
@keyframes fadeIn { from {opacity:0;transform:translateY(20px);} to {opacity:1;transform:translateY(0);} }
.pulse-success { animation: pulseSuccess 1.5s ease-in-out; }
@keyframes pulseSuccess {0%{transform:scale(1);}50%{transform:scale(1.05);background-color:#8BD24D;}100%{transform:scale(1);}}
.highlight { font-weight:bold; font-size:1.25rem; color:#8BD24D;}
.footer { text-align:center; padding:1rem; font-size:0.9rem; background:#f0f0f0; margin-top:2rem; }
.button-green { background-color:#8BD24D; color:white; padding:0.75rem 1rem; border-radius:0.75rem; font-weight:bold; cursor:pointer; transition:0.3s; }
.button-green:hover { background-color:#76b441; }
.button-gray { background-color:#ccc; color:#333; padding:0.5rem 1rem; border-radius:0.75rem; cursor:pointer; }
.hidden { display:none; }
input { padding:0.75rem; border-radius:0.75rem; border:2px solid #ccc; width:100%; margin-bottom:0.5rem; }
</style>
</head>
<body>

<div class="header">
  <img src="monograma.png" alt="Monograma Jackeline & Samarthony" />
  <div class="text-lg font-bold">Jackeline & Samarthony</div>
  <div class="text-sm">06/12/2025 - Du Eventos</div>
</div>

<div class="max-w-xl mx-auto mt-6 text-center">
  <div class="flex justify-between mb-4">
    <div>Chegaram: <span id="checkedInCount">0</span></div>
    <div>Total: <span id="totalGuests">0</span></div>
    <div>Pendentes: <span id="pendingCount">0</span></div>
  </div>
</div>

<div class="max-w-xl mx-auto bg-white p-6 rounded-xl shadow-md">
  <input type="text" id="searchInput" placeholder="Digite nome, apelido ou telefone" onkeyup="searchGuest(event)">
  <button class="button-green w-full mb-2" onclick="performSearch()">Buscar Convidado</button>
  <button class="button-gray w-full mb-2" onclick="refreshData()">ðŸ”„ Atualizar Dados</button>
  <div id="searchResults" class="mt-4 hidden"></div>
</div>

<!-- Modal de ConfirmaÃ§Ã£o -->
<div id="confirmationModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-xl max-w-sm text-center">
    <p id="modalMessage" class="mb-4 font-semibold"></p>
    <div class="flex justify-around">
      <button class="button-green" onclick="confirmCheckin()">Confirmar</button>
      <button class="button-gray" onclick="cancelCheckin()">Cancelar</button>
    </div>
  </div>
</div>

<!-- Tela de Check-in Confirmado -->
<div id="checkinConfirmation" class="hidden max-w-xl mx-auto mt-6 p-6 bg-white rounded-xl shadow-md fade-in text-center">
  <h2 class="text-2xl mb-2">âœ… Check-in realizado!</h2>
  <p id="confirmedName" class="mb-2 font-semibold"></p>
  <p id="confirmedTable" class="highlight mb-4"></p>
  <button class="button-gray" onclick="newSearch()">Novo Check-in</button>
</div>

<div class="footer">
  Criado por Katiene Barbosa
</div>

<script>
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzztcB7qdvZRfAVz3w-VuSyCfBSbmUYwll5bJ1iyYCZ5EoB9eIrc6f9_b7ZyG48lYp9/exec';
let guests=[], checkedInGuests=0, selectedGuest=null;

// Carrega convidados
async function loadGuestsFromSheets(){
  try{
    const res = await fetch(`${APPS_SCRIPT_URL}?action=getGuests`);
    const data = await res.json();
    if(data.success){
      guests = data.guests;
      checkedInGuests = guests.filter(g=>g.status==='confirmado').length;
      updateCounters();
    }
  }catch(e){console.error(e);}
}

// Atualiza contadores
function updateCounters(){
  document.getElementById('checkedInCount').textContent = checkedInGuests;
  document.getElementById('totalGuests').textContent = guests.length;
  document.getElementById('pendingCount').textContent = guests.length - checkedInGuests;
}

// Busca ao pressionar Enter
function searchGuest(e){ if(e.key==='Enter') performSearch(); }

// Realiza busca
function performSearch(){
  const term = document.getElementById('searchInput').value.toLowerCase();
  const div = document.getElementById('searchResults');
  div.innerHTML=''; div.classList.add('hidden');
  if(!term){ div.innerHTML='<p>Digite nome, apelido ou telefone</p>'; div.classList.remove('hidden'); return;}
  const results = guests.filter(g=> g.nome.toLowerCase().includes(term) || g.apelido.toLowerCase().includes(term) || g.telefone.includes(term));
  if(results.length===0){ div.innerHTML='<p>Nenhum convidado encontrado</p>'; div.classList.remove('hidden'); return;}
  results.forEach(g=>{
    const btn=document.createElement('button');
    btn.className='button-gray w-full mb-1 text-left';
    btn.textContent=`${g.nome} (${g.apelido}) - ${g.telefone}`;
    if(g.status==='confirmado') btn.style.backgroundColor='#8BD24D';
    btn.onclick=()=>openConfirmationModal(g);
    div.appendChild(btn);
  });
  div.classList.remove('hidden');
}

// Abre modal de confirmaÃ§Ã£o
function openConfirmationModal(guest){
  if(guest.status==='confirmado'){ alert('Check-in jÃ¡ realizado!'); return; }
  selectedGuest = guest;
  document.getElementById('modalMessage').textContent = `Confirmar check-in de ${guest.nome} (${guest.mesa})?`;
  document.getElementById('confirmationModal').classList.remove('hidden');
}

// Cancelar
function cancelCheckin(){ selectedGuest=null; document.getElementById('confirmationModal').classList.add('hidden'); }

// Confirmar
async function confirmCheckin(){
  if(!selectedGuest) return;
  try{
    const payload = {action:'checkin', guestId:selectedGuest.id, timestamp:new Date().toISOString()};
    const res = await fetch(APPS_SCRIPT_URL,{method:'POST',body:JSON.stringify(payload)});
    const data = await res.json();
    if(data.success){
      selectedGuest.status='confirmado';
      checkedInGuests++;
      updateCounters();
      showCheckinConfirmation(selectedGuest);
    }else{ alert(data.error); }
  }catch(e){console.error(e);}
  cancelCheckin();
}

// Mostra check-in confirmado
function showCheckinConfirmation(guest){
  document.getElementById('confirmedName').textContent = guest.nome;
  document.getElementById('confirmedTable').textContent = guest.mesa;
  document.getElementById('checkinConfirmation').classList.remove('hidden');
  document.getElementById('checkinConfirmation').classList.add('pulse-success');
}

// Novo check-in
function newSearch(){
  selectedGuest=null;
  document.getElementById('searchInput').value='';
  document.getElementById('searchResults').innerHTML=''; document.getElementById('searchResults').classList.add('hidden');
  document.getElementById('checkinConfirmation').classList.add('hidden'); document.getElementById('checkinConfirmation').classList.remove('pulse-success');
  document.getElementById('searchInput').focus();
}

// Atualizar dados
async function refreshData(){ await loadGuestsFromSheets(); alert('Dados atualizados!'); }

// InicializaÃ§Ã£o
loadGuestsFromSheets();
updateCounters();
document.getElementById('searchInput').focus();
</script>

</body>
</html>
